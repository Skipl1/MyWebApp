@model MyWebApp.Models.AcademicProgram

@{
    // 1. –ò–∑–º–µ–Ω–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    ViewData["Title"] = $"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã: {Model.Name}";
}

<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

<div class="container create-program-container">
    <a asp-action="Index" class="back-button">
        <i class="fas fa-arrow-left mr-2"></i> –ö —Å–ø–∏—Å–∫—É
    </a>

    <form asp-action="Edit" method="post" id="createForm">
        @Html.AntiForgeryToken()
        
        <input type="hidden" asp-for="Id" />
        <input type="hidden" asp-for="Status" /> 
        
        <div class="main-card">
            <div class="main-card-header">
                <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—á–µ–±–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã: @Model.Name</h2>
            </div>

            <div class="card-body-custom">
                <div asp-validation-summary="All" class="text-danger mb-3"></div>

                <div class="row mb-4">
                    <div class="col-lg-8">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label asp-for="Name">–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã *</label>
                                    <input asp-for="Name" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label asp-for="DisciplineId">–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ *</label>
                                    <select asp-for="DisciplineId" class="form-control" id="disciplineSelect" asp-items="ViewBag.Disciplines">
                                        <option value="" disabled>-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-2">
                            <div class="col-md-8">
                                <div class="form-group">
                                    <label asp-for="SpecialtyId">–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å *</label>
                                    <select asp-for="SpecialtyId" class="form-control" id="specialtySelect" asp-items="ViewBag.Specialties">
                                        <option value="" disabled>-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label asp-for="StartYear">–ì–æ–¥ –Ω–∞—á–∞–ª–∞ *</label>
                                    <input asp-for="StartYear" type="number" class="form-control" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="info-panel">
                            <div class="info-item">
                                <div class="info-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
                                <input type="text" id="directionField" class="readonly-box" readonly value="‚Äî" />
                            </div>
                            <div class="info-item mt-3">
                                <div class="info-label">–°—Ä–æ–∫ –æ–±—É—á–µ–Ω–∏—è</div>
                                <input type="text" id="durationField" class="readonly-box" readonly value="‚Äî" />
                            </div>
                            <div class="info-item mt-3">
                                <div class="info-label">–ö–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏</div>
                                <textarea id="competenciesField" class="readonly-box" rows="4" readonly style="resize:none;">‚Äî</textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <hr />

                <h5 class="mt-4 mb-3" style="color: #333;">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤</h5>
                <div id="teacherHelp" class="text-muted small mb-2">
                    <i class="fas fa-info-circle"></i> –í—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.
                </div>
                <table class="table table-bordered table-sm">
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                            <th>–¢–∏–ø —É—á–∞—Å—Ç–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="teachersList">
                    </tbody>
                </table>

                <hr class="my-5"/>

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 style="color: var(--primary-color);">–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω –ø–æ —Å–µ–º–µ—Å—Ç—Ä–∞–º</h4>
                </div>

                <div id="semestersContainer">
                </div>

                <button type="button" class="btn btn-add-sem" onclick="addSemesterBlock()">
                    <i class="fas fa-plus-circle"></i> –î–û–ë–ê–í–ò–¢–¨ –°–ï–ú–ï–°–¢–†
                </button>

                <hr class="my-5"/>

                <h4 style="color: var(--primary-color); margin-bottom: 20px;">–ú–µ—Ç–æ–¥–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</h4>
                
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="methodical-box">
                            <label asp-for="Goals" class="methodical-label">–¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏</label>
                            <textarea asp-for="Goals" class="textarea-square" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã..."></textarea>
                            <span asp-validation-for="Goals" class="text-danger"></span>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-4">
                        <div class="methodical-box">
                            <label asp-for="Requirements" class="methodical-label">–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —É—Ä–æ–≤–Ω—é –æ—Å–≤–æ–µ–Ω–∏—è</label>
                            <textarea asp-for="Requirements" class="textarea-square" placeholder="–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –∏ —É–º–µ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç..."></textarea>
                            <span asp-validation-for="Requirements" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="methodical-box">
                            <label asp-for="DisciplinePosition" class="methodical-label">–ú–µ—Å—Ç–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ</label>
                            <textarea asp-for="DisciplinePosition" class="textarea-square" placeholder="–°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞–º–∏..."></textarea>
                            <span asp-validation-for="DisciplinePosition" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="methodical-box">
                            <label asp-for="Literature" class="methodical-label">–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</label>
                            <textarea asp-for="Literature" class="textarea-square" placeholder="–°–ø–∏—Å–æ–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã..."></textarea>
                            <span asp-validation-for="Literature" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <button type="submit" class="btn btn-primary btn-lg btn-block" style="padding: 15px; font-weight: bold;">
                        <i class="fas fa-save mr-2"></i> –°–û–•–†–ê–ù–ò–¢–¨ –ò–ó–ú–ï–ù–ï–ù–ò–Ø
                    </button>
                </div>

            </div>
        </div>
    </form>
</div>

---

## üíª JavaScript (–õ–æ–≥–∏–∫–∞ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–û—Å–Ω–æ–≤–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–¥–µ—Å—å:
1.  –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ **`addSectionRowWithData`** –∏ **`addSemesterBlockWithData`** –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –º–æ–¥–µ–ª–∏.
2.  –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ **`loadExistingData`** –≤ `$(document).ready` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∞–Ω–Ω—ã–º–∏.
3.  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **Razor** –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ JavaScript.

```javascript
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –Ω–æ–≤—ã—Ö —Å–µ–º–µ—Å—Ç—Ä–æ–≤/—Å–µ–∫—Ü–∏–π
        let semesterIndex = 0;

        // --- 1. –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è ---
        function createTeacherRow(teacherId = null, participationType = null, teacherName = null) {
            const displayTeacherName = teacherName || `ID: ${teacherId}`;
            const pType = participationType || '‚Äî';
            return `
                <tr>
                    <td>
                        <input type="hidden" name="Teachers[${teacherId}].TeacherId" value="${teacherId}" />
                        <span class="font-weight-bold">${displayTeacherName}</span>
                    </td>
                    <td>
                        <input type="hidden" name="Teachers[${teacherId}].ParticipationType" value="${participationType}" />
                        <span class="badge badge-light border p-2">${pType}</span>
                    </td>
                </tr>
            `;
        }

        // --- 2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Ä–∞–∑–¥–µ–ª–∞ (—Å –¥–∞–Ω–Ω—ã–º–∏) ---
        function addSectionRowWithData(parentIndex, sectionIndex, sectionData = {}) {
            const tbody = document.querySelector(`.sections-body[data-parent-index="${parentIndex}"]`);
            if (!tbody) return;

            // –ï—Å–ª–∏ data –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â—É—é –¥–ª–∏–Ω—É –∫–∞–∫ –∏–Ω–¥–µ–∫—Å (–¥–ª—è –ù–û–í–´–•)
            const actualSectionIndex = sectionData.Index !== undefined ? sectionData.Index : tbody.children.length;
            
            const row = document.createElement('tr');
            
            row.innerHTML = `
                <td>
                    <input type="text" name="WorkLoads[${parentIndex}].Sections[${actualSectionIndex}].Index" class="table-input text-center" value="${actualSectionIndex + 1}" readonly style="background:#f8f9fa;" />
                </td>
                <td>
                    <input type="text" name="WorkLoads[${parentIndex}].Sections[${actualSectionIndex}].Name" class="table-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ..." required value="${sectionData.Name || ''}" />
                </td>
                <td>
                    <textarea name="WorkLoads[${parentIndex}].Sections[${actualSectionIndex}].Description" class="table-input" rows="1" placeholder="–ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ..." style="resize:vertical;">${sectionData.Description || ''}</textarea>
                </td>
                <td><input type="number" name="WorkLoads[${parentIndex}].Sections[${actualSectionIndex}].LectureHours" class="table-input text-center" value="${sectionData.LectureHours || 0}" /></td>
                <td><input type="number" name="WorkLoads[${parentIndex}].Sections[${actualSectionIndex}].LabHours" class="table-input text-center" value="${sectionData.LabHours || 0}" /></td>
                <td><input type="number" name="WorkLoads[${parentIndex}].Sections[${actualSectionIndex}].SeminarHours" class="table-input text-center" value="${sectionData.SeminarHours || 0}" /></td>
                <td><input type="number" name="WorkLoads[${parentIndex}].Sections[${actualSectionIndex}].SelfStudyHours" class="table-input text-center" value="${sectionData.SelfStudyHours || 0}" /></td>
                <td class="text-center">
                    <button type="button" class="btn btn-sm text-danger" onclick="this.closest('tr').remove()" title="–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫—É">
                        <i class="fas fa-times"></i>
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        }
        
        // --- 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞ —Å–µ–º–µ—Å—Ç—Ä–∞ (—Å –¥–∞–Ω–Ω—ã–º–∏) ---
        function addSemesterBlockWithData(currentSemIndex, data = {}) {
            const container = document.getElementById('semestersContainer');
            
            const block = document.createElement('div');
            block.classList.add('semester-card');
            block.setAttribute('data-index', currentSemIndex);

            block.innerHTML = `
                <div class="semester-header-custom">
                    <div class="d-flex align-items-center">
                        <h5 class="mb-0 text-primary font-weight-bold mr-3">–°–µ–º–µ—Å—Ç—Ä</h5>
                        <div class="input-group input-group-sm" style="width: 150px;">
                            <div class="input-group-prepend">
                                <span class="input-group-text">‚Ññ</span>
                            </div>
                            <input type="number" name="WorkLoads[${currentSemIndex}].Semester" class="form-control font-weight-bold" required min="1" value="${data.Semester || (currentSemIndex + 1)}" />
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSemester(this)">
                        <i class="fas fa-trash-alt"></i> –£–¥–∞–ª–∏—Ç—å
                    </button>
                </div>
                
                <div class="workload-grid">
                    <div class="workload-item">
                        <label>–õ–µ–∫—Ü–∏–∏ (—á)</label>
                        <input type="number" name="WorkLoads[${currentSemIndex}].Lectures" class="form-control" value="${data.Lectures || 0}" />
                    </div>
                    <div class="workload-item">
                        <label>–õ–∞–±. (—á)</label>
                        <input type="number" name="WorkLoads[${currentSemIndex}].Labs" class="form-control" value="${data.Labs || 0}" />
                    </div>
                    <div class="workload-item">
                        <label>–ü—Ä–∞–∫—Ç. (—á)</label>
                        <input type="number" name="WorkLoads[${currentSemIndex}].Seminars" class="form-control" value="${data.Seminars || 0}" />
                    </div>
                    <div class="workload-item">
                        <label>–°–∞–º. —Ä–∞–± (—á)</label>
                        <input type="number" name="WorkLoads[${currentSemIndex}].SelfStudy" class="form-control" value="${data.SelfStudy || 0}" />
                    </div>
                    <div class="workload-item">
                        <label>–ê—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è</label>
                        <select name="WorkLoads[${currentSemIndex}].AssessmentType" class="form-control">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ --</option>
                            <option value="–≠–∫–∑–∞–º–µ–Ω" ${data.AssessmentType === '–≠–∫–∑–∞–º–µ–Ω' ? 'selected' : ''}>–≠–∫–∑–∞–º–µ–Ω</option>
                            <option value="–ó–∞—á–µ—Ç" ${data.AssessmentType === '–ó–∞—á–µ—Ç' ? 'selected' : ''}>–ó–∞—á–µ—Ç</option>
                            <option value="–ö—É—Ä—Å–æ–≤–∞—è" ${data.AssessmentType === '–ö—É—Ä—Å–æ–≤–∞—è' ? 'selected' : ''}>–ö—É—Ä—Å–æ–≤–∞—è</option>
                        </select>
                    </div>
                </div>

                <div class="sections-wrapper">
                    <h6 class="text-secondary mb-2">–†–∞–∑–¥–µ–ª—ã –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã:</h6>
                    <table class="table table-bordered table-sm table-custom">
                        <thead>
                            <tr>
                                <th style="width: 50px;">#</th>
                                <th style="width: 30%;">–ù–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞</th>
                                <th style="width: 30%;">–ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</th>
                                <th style="width: 7%;">–õ–µ–∫.</th>
                                <th style="width: 7%;">–õ–∞–±.</th>
                                <th style="width: 7%;">–°–µ–º.</th>
                                <th style="width: 7%;">–°–†–°</th>
                                <th style="width: 40px;"></th>
                            </tr>
                        </thead>
                        <tbody class="sections-body" data-parent-index="${currentSemIndex}">
                        </tbody>
                    </table>
                    <button type="button" class="btn btn-sm btn-outline-secondary" onclick="addSectionRowWithData(${currentSemIndex})">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª
                    </button>
                </div>
            `;
            
            container.appendChild(block);
            semesterIndex++;
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
            if (data.Sections && data.Sections.length > 0) {
                data.Sections.forEach((section, index) => {
                    // –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å, —á—Ç–æ–±—ã –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª –º–∞—Å—Å–∏–≤—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                    addSectionRowWithData(currentSemIndex, index, section);
                });
            }
        }
        
        // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–¥–ª—è –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å —Å–µ–º–µ—Å—Ç—Ä")
        function addSemesterBlock() {
            addSemesterBlockWithData(semesterIndex);
        }
        function addSectionRow(parentIndex) {
            addSectionRowWithData(parentIndex);
        }

        function removeSemester(btn) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Å–µ–º–µ—Å—Ç—Ä?')) {
                btn.closest('.semester-card').remove();
            }
        }

        // --- 4. –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ---
        function loadExistingData() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–º–µ—Å—Ç—Ä–æ–≤ –∏ —Ä–∞–∑–¥–µ–ª–æ–≤
            const existingWorkLoads = @Html.Raw(Json.Serialize(Model.WorkLoads ?? new List<WorkLoad>()));
            
            existingWorkLoads.forEach(workLoad => {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º WorkLoad.Id –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å, –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ —Å—á–µ—Ç—á–∏–∫
                const workLoadIndex = workLoad.Id || semesterIndex;
                addSemesterBlockWithData(workLoadIndex, workLoad);
            });

            // –ï—Å–ª–∏ —Å–µ–º–µ—Å—Ç—Ä–æ–≤ –Ω–µ –±—ã–ª–æ, ensure semesterIndex is correctly set for future new blocks
            if (existingWorkLoads.length > 0) {
                // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ID / –∏–Ω–¥–µ–∫—Å –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –Ω—É–º–µ—Ä–∞—Ü–∏–∏
                const maxIndex = existingWorkLoads.reduce((max, current) => Math.max(max, current.Id || current.Semester || 0), 0);
                semesterIndex = maxIndex + 1;
            }


            // –ï—Å–ª–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ —É–∂–µ –≤—ã–±—Ä–∞–Ω–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–π
            const disciplineId = $('#disciplineSelect').val();
            if (disciplineId) {
                // –ï—Å–ª–∏ –º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º, —Ç–æ —É –Ω–∞—Å –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ø–∏—Å–æ–∫ Teachers, 
                // –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å, –Ω–æ –¥–ª—è AJAX –Ω–∞–º –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω—É–∂–Ω–æ 
                // –≤—ã–∑–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã.
                // –í —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã –ø–æ–ª–∞–≥–∞–µ–º—Å—è –Ω–∞ AJAX, –∫–∞–∫ –∏ –≤ Create.
                $('#disciplineSelect').trigger('change');
            }
        }


        // --- AJAX –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
        $(document).ready(function () {
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
            $('#specialtySelect').change(function () {
                var specialtyId = $(this).val();
                if (specialtyId) {
                    $.ajax({
                        url: '@Url.Action("GetSpecialtyDetails", "AcademicProgram")',
                        type: 'GET',
                        data: { specialtyId: specialtyId },
                        success: function (data) {
                            $('#directionField').val(data.direction);
                            $('#durationField').val(data.duration);
                            $('#competenciesField').val(data.competencies);
                        },
                        error: function () {
                            $('#directionField').val('–û—à–∏–±–∫–∞');
                        }
                    });
                } else {
                    $('#directionField').val('‚Äî');
                    $('#durationField').val('‚Äî');
                    $('#competenciesField').val('‚Äî');
                }
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã (–∑–∞–≥—Ä—É–∑–∫–∞ —É—á–∏—Ç–µ–ª–µ–π)
            $('#disciplineSelect').change(function () {
                var disciplineId = $(this).val();
                $('#teachersList').empty();
                
                if (disciplineId) {
                    $.ajax({
                        url: '@Url.Action("GetDisciplineTeachers", "AcademicProgram")',
                        type: 'GET',
                        data: { disciplineId: disciplineId },
                        success: function (data) {
                            if (data.assignedTeachers && data.assignedTeachers.length > 0) {
                                data.assignedTeachers.forEach(function(dt) {
                                    // –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: TeacherId –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —á–∞—Å—Ç—å –∏–º–µ–Ω–∏ –ø–æ–ª—è 
                                    // –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –≤ –º–∞—Å—Å–∏–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.
                                    const row = createTeacherRow(dt.id, dt.participationType, dt.name); 
                                    $('#teachersList').append(row);
                                });
                                $('#teacherHelp').html(`<span class="text-success"><i class="fas fa-check"></i> –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</span>`);
                            } else {
                                $('#teacherHelp').text('–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –Ω–µ –∑–∞–∫—Ä–µ–ø–ª–µ–Ω—ã.');
                            }
                        },
                        error: function () {
                            $('#teacherHelp').text('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏.');
                        }
                    });
                }
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è. –ó–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –æ–Ω–∏ –±—ã–ª–∏ –≤—ã–±—Ä–∞–Ω—ã
            if ($('#specialtySelect').val()) $('#specialtySelect').trigger('change');
            
            // ‚≠êÔ∏è –ó–ê–ü–£–°–ö –ó–ê–ì–†–£–ó–ö–ò –°–£–©–ï–°–¢–í–£–Æ–©–ò–• –î–ê–ù–ù–´–•
            loadExistingData();

            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
            if ($('#disciplineSelect').val()) $('#disciplineSelect').trigger('change');
        });
    </script>
}