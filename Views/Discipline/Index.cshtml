@model IEnumerable<MyWebApp.Models.Discipline>
<link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

@{
    // !!! –ò–ó–ú–ï–ù–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º ViewBag.IsAdmin –≤–º–µ—Å—Ç–æ ViewBag.CurrentUserRole !!!
    var isAdmin = (bool)ViewBag.IsAdmin; 
    
    // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è currentUserRole –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞
    // var currentUserRole = (string)ViewBag.CurrentUserRole; // –£–î–ê–õ–ï–ù–û

    var newDiscipline = (MyWebApp.Models.Discipline)ViewBag.NewDiscipline;
    var totalCount = Model.Count();
    // –ü–æ–ª—É—á–∞–µ–º ID, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
    var editId = ViewBag.EditDisciplineId as int?;
}

<div class="container discipline-container">
    
    <a href="/" class="back-button">
        <span class="back-icon">‚Üê</span> –ù–∞ –≥–ª–∞–≤–Ω—É—é
    </a>

    <h2 class="discipline-title">üìö –°–ø–∏—Å–æ–∫ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω (@totalCount)</h2>
    
    @* === –ë–õ–û–ö –î–û–ë–ê–í–õ–ï–ù–ò–Ø –î–ò–°–¶–ò–ü–õ–ò–ù–´ (–¢–û–õ–¨–ö–û –î–õ–Ø –ê–î–ú–ò–ù–ê) === *@
    @if (isAdmin) // –ó–ê–©–ò–¢–ê –ê–î–ú–ò–ù–ê
    {
        <div class="create-form-section">
            <h4>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É</h4>
            
            <form asp-action="Index" method="post" class="form-add-discipline">
                
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                <div class="input-group">
                    <input type="text" asp-for="@newDiscipline.Name" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)" />
                    <button type="submit" class="btn btn-success add-button">–î–æ–±–∞–≤–∏—Ç—å</button>
                </div>
                
                <span class="text-danger">@Html.ValidationMessageFor(m => newDiscipline.Name)</span>
            </form>
        </div>
        
        <hr class="separator" />
    }
    
    @* === –°–ü–ò–°–û–ö –î–ò–°–¶–ò–ü–õ–ò–ù (–° –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï–ú) === *@
    <div class="discipline-list">
        @if (Model.Any())
        {
            @foreach (var discipline in Model)
            {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ñ–æ—Ä–º—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–¢–û–õ–¨–ö–û –î–õ–Ø –ê–î–ú–ò–ù–ê –ò –°–û–í–ü–ê–î–ê–Æ–©–ï–ì–û ID)
                if (isAdmin && discipline.Id == editId) // –ò–°–ü–û–õ–¨–ó–£–ï–ú isAdmin
                {
                    // --- –§–û–†–ú–ê –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø ---
                    @* ... –í–Ω—É—Ç—Ä–∏ —Ü–∏–∫–ª–∞ foreach, –±–ª–æ–∫ if (isAdmin && discipline.Id == editId) ... *@

                    <div class="discipline-item edit-mode">
                        <form asp-action="EditConfirmed" asp-route-id="@discipline.Id" method="post" class="form-inline-edit">
                            
                            @* –Ø–í–ù–û —É–∫–∞–∑—ã–≤–∞–µ–º name="Id", —á—Ç–æ–±—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –µ–≥–æ —É–≤–∏–¥–µ–ª *@
                            <input type="hidden" asp-for="@discipline.Id" name="Id" />
                            
                            @Html.AntiForgeryToken()
                            
                            <div class="discipline-info">
                                <div class="discipline-row">
                                    <div class="discipline-icon">üìù</div> 
                                    
                                    @* –Ø–í–ù–û —É–∫–∞–∑—ã–≤–∞–µ–º name="Name" *@
                                    <input type="text" asp-for="@discipline.Name" name="Name" class="form-control edit-input" />
                                </div>
                                @* –í—ã–≤–æ–¥ –æ—à–∏–±–∫–∏ *@
                                <span class="text-danger">@Html.ValidationMessageFor(m => discipline.Name)</span>
                            </div>
                            
                            <div class="admin-actions">
                                <button type="submit" class="btn btn-sm btn-success">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                <a asp-action="Index" class="btn btn-sm btn-secondary">–û—Ç–º–µ–Ω–∞</a>
                            </div>
                        </form>
                    </div>
                }
                else
                {
                    // --- –°–¢–ê–ù–î–ê–†–¢–ù–ê–Ø –ö–ê–†–¢–û–ß–ö–ê ---
                    <div class="discipline-item">

                        <div class="discipline-info">
                            <div class="discipline-row">
                                <div class="discipline-icon">üìë</div> 
                                <div class="discipline-name">@discipline.Name</div>
                            </div>
                        </div>
                        
                        @if (isAdmin) // –ò–°–ü–û–õ–¨–ó–£–ï–ú isAdmin
                        {
                            <div class="admin-actions">
                                <a asp-action="Index" asp-route-editId="@discipline.Id" class="btn btn-sm btn-edit">üñäÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                            </div>
                        }

                    </div>
                }
            }
        }
        else
        {
            <div class="empty-message">
                <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω.</p>
            </div>
        }
    </div>
</div>